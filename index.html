<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Antares Agent Client-side Test</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <script src="//cdnjs.cloudflare.com/ajax/libs/rxjs/6.2.1/rxjs.umd.min.js"></script>
    <script src="//unpkg.com/redux@4.0.0/dist/redux.js"></script>
    <script src="./dist/antares-protocol.js"></script>
    <script>
        let agent
        let after // an RxJS-Observable-based delay utility
        let ajaxStreamingGet
        let randomIdFilter
        if (typeof AntaresProtocol !== "undefined") {
            agent = new AntaresProtocol.Agent
            after = AntaresProtocol.after
            ajaxStreamingGet = AntaresProtocol.ajaxStreamingGet
            randomIdFilter = AntaresProtocol.randomIdFilter
            console.log("Antares is Ready")
        } else {
            console.log("Antares Loading Error")
        }

        // Welcome, reader of the Source!
        // This is just a little demo to show how in Antares you
        // - Define event-handling behavior which
        //   - matches on type and
        //   - returns an Observable
        // - Process some actions or subscribe to a process which does
        // What it does: We send you to a new browser location (in your Address Bar)
        // while you read this

        // Define a renderer which changes the browser's address bar (after a delay)
        agent.on('browser/go', ({ action }) => {
            return after(2000, () => document.location.hash = action.payload)
        })
        const store = Redux.createStore(
            (state = {}) => state,
            window.__REDUX_DEVTOOLS_EXTENSION__ && window.__REDUX_DEVTOOLS_EXTENSION__()
        )

        // append a random GIT-SHA-like identifier to each action
        agent.addFilter(randomIdFilter())
        // Send all actions, including those returned by renderers through the store
        agent.addFilter(({ action }) => store.dispatch(action))

        document.addEventListener('DOMContentLoaded', () => {
            // Kick off the action - we should expect to see an update in the address bar!
            agent.process({
                type: 'browser/go',
                payload: '#WhatWouldYouLikeToKnow?'
            })
        })
    </script>
    <style>
        #c {
            border: 0.5px solid black;
            width: 60px;
            height: 20px;
        }
    </style>
</head>

<body>
    <h5>Antares is watching you!</h5>
    <canvas id="c"></canvas>
    <h1>Links</h1>
    <ul>
        <li>
            <a href="docs/index.html">JSDoc Documentation</a>
        </li>
        <li>
            <a href="javascript:window.__REDUX_DEVTOOLS_EXTENSION__.open()">Open DevTools</a>
        </li>
    </ul>

    <!-- A use of RxJS (without Antares) to do a fun animation -->

    <script src="demos/home/kitt.js"></script>

</body>

</html>
